---
import { formatQuotes } from "@probablyduncan/common/quotes";
import { getCollection } from "astro:content";
import Ticker from "../components/ticker.astro";
import BaseMetadata from "../components/head/base-metadata.astro";
import GlobalStylesLoader from "../components/head/global-styles-loader.astro";
import PageMetadata from "../components/head/page-metadata.astro";
import RadioFilters from "../components/filterable/radio-filters.astro";
import FilterableListItem from "../components/filterable/filterable-list-item.astro";

const links = (await getCollection("weblinks")).sort((a, b) =>
    b.data.date.obj > a.data.date.obj
        ? 1
        : a.data.date.obj > b.data.date.obj
          ? -1
          : 0,
);
const tags = [...new Set(links.flatMap((l) => l.data.tags))].sort();
---

<!doctype html>
<html lang="en">
    <head>
        <BaseMetadata />
        <GlobalStylesLoader />
        <PageMetadata
            title="Duncan‚Äôs Weblinks"
            desc="These are some websites that Duncan likes to visit. Personal sites, archives, hypertext poetry, dev tools, and more. Happy exploring."
        />
        <title>Duncan‚Äôs Weblinks</title>
    </head>
    <body>
        <Ticker />
        <header>
            <h1>A few of the websites I have loved</h1>
            <p>Sometimes you‚Äôre surfing the web and you lose your balance.</p>
            <p>
                Your board shoots out from under you, and suddenly you‚Äôre
                tumbling, flailing, breaking against the breaking waves. Water
                shoots up your nose, and there‚Äôs nothing but froth and spray as
                you are flung, enveloped, imbibed by the water and you are
            </p>
            <details>
                <summary aria-hidden="true"
                    >[...]&nbsp;&nbsp;&nbsp;&nbsp;<i>expand</i></summary
                >
                <p aria-hidden="true"><span class="invisible">[</span>...</p>
                <p>
                    and you are a hyper text transfer protozoa in the primordial
                    soup of the world wide web, the ebb and the rush of the open
                    ocean‚Äôs tide is turning you ‚Äòround, float: left and luring,
                    cradling, coaxing you down the water column-gap, whispering
                    promises in a language of salt and semantics, pulling at
                    your ankles and you
                </p>
                <p>
                    you could be here forever‚Äîyou could make a life here
                    forever, cross-hatched and folded by the current, flex-boxed
                    and text-wrapped, half-limp, finger-clicking link after link
                    after link, as the internet archive fills your lungs and
                    wikimedia‚Äôs weight drags you down, further and further, and
                    you circle into webrings like whirlpools, down, down, to
                    where there is no light, spinning ‚Äòround, and ‚Äòround, and
                    ‚Äòround, centrifugal twirl like tumble dry if you weren‚Äôt so
                    soaked in aria mislabels and thirty-year-old footer gifs
                    like billboards at the geo-city limits and pixel-perfect
                    mockups best viewed at 800êçá600 and crafted so lovingly in
                    photoshop and frankensteined so carefully into schools of
                    <span class="small-caps">tr</span>‚Äôs and <span class="small-caps">th</span>‚Äôs and <span class="small-caps">td</span>‚Äôs darting past in the whirling
                    maelstrom and the frames of your vision and‚Äî
                </p>
                <p>
                    and then you are flung out into the empty, the vastness, the
                    sunless deep, and hyperlink blue fills your vision,
                    hyperlink blue, the hyperlink blue of that entrancing,
                    surging, living abyss, and there is nothing‚Äîno framework, no
                    polyfill, no jquery.min.js or reset.css or favicon.ico‚Äîand
                    you spin, slowly now, in open-eyed awe of all of the nothing
                    around you, and you are small, and you are content,
                </p>
                <p aria-hidden="true"><span class="invisible">[</span>...</p>
            </details>
            <p>and you are glad you went surfing. &nbsp;Anyway,</p>
        </header>
        <main>
            <RadioFilters tags={tags} listName="weblinks" showAll="first" />
            <ul>
                {
                    links.map(({ data: l }) => {
                        return (
                            <FilterableListItem listName="weblinks" tags={l.tags}>
                                <div class="link-wrapper">
                                    <div class="link-top">
                                        <span class="link-date">
                                            {l.date.text}
                                            &nbsp;&nbsp;|&nbsp;&nbsp;
                                        </span>
                                        <span class="link-tags">{l.tags.sort().map((t, i) => (<>
                                        <label for={`weblinks-filter-${t}`}>#{t}</label>{i !== l.tags.length - 1 && ","}
                                        </>))}</span>
                                    </div>
                                    <div class="link-bottom">
                                        <span class="link-title">[{l.title}](<a class="link-link" title={`${l.title}: ${l.href}`} href={l.href} target="_blank">{l.href}</a>)</span><span class="link-desc"> <span class="desc-dash">&mdash;</span>&mdash; {formatQuotes(l.desc)}</span>
                                    </div>
                                </div>
                            </FilterableListItem>
                        );
                    })
                }
            </ul>
        </main>
        <aside>
            <a href="/" title="back! to the home page">
                <span data-flipbook data-alt="‚Ü©" />
            </a>
        </aside>
    </body>
    <style>

        :root {
            /* overscroll-behavior: unset; */
            --color-primary: #0000EE;
            --color-secondary: #551A8B;
        }

        body {
            display: flex;
            flex-direction: column;
            padding-inline: var(--padding);
            gap: var(--padding);
        }

        .invisible {
            visibility: hidden;
        }

        header {
            text-align: justify;
            padding-right: var(--padding);
            padding-top: calc(var(--padding) * 3);
        }

        header,
        main {
            width: min(55ch, 100%);
        }

        h1 {
            font-size: unset;
            font-variation-settings:
                "wght" 600,
                "wdth" 100,
                "ENLA" 20;
        }

        details summary {
            display: inline-block;
            cursor: pointer;
        }

        details summary i {
            font-variation-settings:
                "wght" 400,
                "wdth" 100,
                "ENLA" 0;
            transition: font-variation-settings 0.5s;
        }

        details summary:hover i {
            font-variation-settings:
                "wght" 500,
                "wdth" 120,
                "ENLA" 40;
        }

        details[open] summary {
            display: none;
        }

        main {
            margin-bottom: 80svh;
        }

        /* WEBLINK ITEMS */

        ul {
            list-style: none;
            padding: 1em 1em 0 0;
            margin: 2em 0 0;
            border-top: 2px solid #0001;
        }

        .link-wrapper {
            font-family: Junicode;
            margin-bottom: 1em;
        }

        .link-top {
            display: flex;
            align-items: center;
            margin-bottom: 0.125rem;
        }

        .link-date {
            color: #222;
            font-variant-numeric: lining-nums;
            font-variation-settings:
                "wght" 500,
                "wdth" 80,
                "ENLA" 0;
            /* font-size: 1.125em; */
            font-size: 0.8em;
        }

        .link-tags {
            color: #444;
            font-weight: 300;
            /* font-size: 0.875em; */
            font-size: 0.8em;

            label {
                cursor: pointer;
                transition: opacity 0.2s;
                &:hover {
                    opacity: 0.6;
                }
                &:active {
                    opacity: 1;
                }
            }
        }

        .link-bottom {
            /* font-size: 1.25em; */
            font-size: 1em;
            line-height: 1.4;
        }

        .link-title {
            color: #222;
            font-variation-settings:
                "wght" 500,
                "wdth" 80,
                "ENLA" 20;
        }

        .link-link {
            color: var(--color-primary);
            text-decoration: underline;
            font-variation-settings:
                "wght" 400,
                "wdth" 87.5,
                "ENLA" 20;
            transition: font-variation-settings 0.5s;
        }

        .link-link:hover {
            text-decoration-style: dotted;
            font-variation-settings:
                "wght" 400,
                "wdth" 100,
                "ENLA" 30;
        }

        .desc-dash {
            display: none;
            letter-spacing: -1px;
        }

        .link-desc {
            color: #444;
        }

        /*  */

        /*  */

        /*  */

        /*  */

        /* FLIPBOOK STUFF */

        aside {
            position: fixed;
            bottom: calc(var(--padding) * 0.75);
            right: var(--padding);
        }

        [data-flipbook] {
            color: black;
            font-size: 1.5em;
            animation: jitter 0.2s ease-in-out infinite;
            text-shadow: 0 0 20px white;
        }

        [data-flipbook]::after {
            content: "";
            display: inline-block;
            animation: flipbook-grow 5s step-end both;
            transition: transform 0.3s ease-out;
            transform-origin: center 42%;
            width: 2ch;
        }

        a:hover [data-flipbook] {
            animation: none;
        }

        a:hover [data-flipbook]::after {
            transform: scale(1.1) rotate(360deg);
            animation: none;
            content: "‚Ü©";
        }

        @keyframes jitter {
            0% {
                font-variation-settings:
                    "wght" 400,
                    "wdth" 99.5,
                    "ENLA" 10;
            }

            25% {
                font-variation-settings:
                    "wght" 500,
                    "wdth" 100,
                    "ENLA" 5;
            }

            50% {
                font-variation-settings:
                    "wght" 400,
                    "wdth" 100.5,
                    "ENLA" 1;
            }

            75% {
                font-variation-settings:
                    "wght" 300,
                    "wdth" 100,
                    "ENLA" 5;
            }

            100% {
                font-variation-settings:
                    "wght" 400,
                    "wdth" 99.5,
                    "ENLA" 10;
            }
        }

        @keyframes flipbook-grow {
            0% {
                content: "‚ÜÄ";
            }

            48% {
                content: "‚ÜÇ";
            }

            49% {
                content: "‚ÜÄ";
            }

            50% {
                content: "‚ÜÇ";
            }

            60% {
                content: "‚Üà";
            }

            61% {
                content: "‚ÜÇ";
            }

            64% {
                content: "‚Üà";
            }

            65% {
                content: "‚ÜÇ";
            }

            70% {
                content: "‚Üà";
            }

            100% {
                content: "‚Üà";
            }
        }
    </style>
</html>
